import{u as A,r as x,j as e,S as $,l as k,F as T,m as y,s as z,p as D}from"./index-CKOHEspy.js";import{B as j,A as B}from"./brain-23wKsOr2.js";function C({icon:r,label:l,isActive:a,isComplete:t,gradient:o}){return e.jsxs("div",{className:`flex items-center gap-4 p-4 rounded-xl transition-all duration-500 ${a?"bg-blue-50 scale-105":t?"bg-green-50":"bg-gray-50"}`,children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center transition-all duration-500 ${a?`bg-gradient-to-r ${o} animate-pulse shadow-lg`:t?"bg-green-500 shadow-md":"bg-gray-200"}`,children:e.jsx(r,{className:`w-6 h-6 ${a||t?"text-white":"text-gray-400"}`})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:`text-sm transition-colors duration-500 ${a?"text-blue-900":t?"text-green-900":"text-gray-500"}`,children:l})}),t&&e.jsx(y,{className:"w-5 h-5 text-green-500 animate-bounce-in"})]})}function O({specialty:r,patientData:l,symptoms:a,onBack:t,onComplete:o}){const i=A(r),[c,w]=x.useState(0),[f,N]=x.useState(null),[F,v]=x.useState(!1),d=[{icon:T,label:"Recopilando informaci√≥n",delay:0},{icon:j,label:"Analizando s√≠ntomas con IA",delay:800},{icon:B,label:"Evaluando gravedad",delay:1600},{icon:y,label:"Generando recomendaciones",delay:2400}];return x.useEffect(()=>{let s=!0;return(async()=>{try{const u=d.map((n,S)=>setTimeout(()=>{s&&w(S+1)},n.delay));console.log("üîç Starting intelligent diagnosis analysis...");const{data:{session:E},error:b}=await z.auth.getSession();if(b)throw console.error("‚ùå Error getting session:",b),new Error("No se pudo obtener la sesi√≥n de autenticaci√≥n");const p=E?.access_token;if(!p)throw console.error("‚ùå No access token found"),new Error("No se encontr√≥ token de autenticaci√≥n. Por favor inicia sesi√≥n nuevamente.");console.log("‚úÖ Access token obtained");const h=await fetch(`https://${D}.supabase.co/functions/v1/make-server-baa51d6b/diagnosis/analyze`,{method:"POST",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"},body:JSON.stringify({patientData:l,symptoms:a,specialty:r})});if(!h.ok){const n=await h.json();throw new Error(n.details||n.error||"Failed to analyze diagnosis")}const g=await h.json();return console.log("‚úÖ Diagnosis analysis complete:",g),s&&(v(!0),setTimeout(()=>{s&&o(g.result,g.metadata)},1e3)),()=>{u.forEach(n=>clearTimeout(n))}}catch(u){console.error("‚ùå Error analyzing diagnosis:",u),s&&N(u.message)}})(),()=>{s=!1}},[r,l,a,o]),e.jsxs($,{children:[e.jsxs(k,{gradient:i.gradient,className:"p-6 text-white text-center",children:[e.jsx("h1",{className:"text-2xl mb-2",children:"An√°lisis en progreso"}),e.jsx("p",{className:"text-white/80 text-sm",children:"Evaluando tu informaci√≥n cl√≠nica con IA"})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8",children:[e.jsxs("div",{className:"relative mb-12",children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-r ${i.gradient} opacity-20 rounded-full animate-ping`,style:{width:"160px",height:"160px",margin:"-20px"}}),e.jsxs("div",{className:`w-32 h-32 bg-gradient-to-r ${i.gradient} rounded-full flex items-center justify-center shadow-2xl relative`,children:[e.jsx(j,{className:"w-16 h-16 text-white animate-pulse"}),e.jsx("div",{className:"absolute inset-0 animate-spin",style:{animationDuration:"3s"},children:e.jsx("div",{className:"absolute top-0 left-1/2 w-3 h-3 bg-white rounded-full -translate-x-1/2"})}),e.jsx("div",{className:"absolute inset-0 animate-spin",style:{animationDuration:"2s",animationDirection:"reverse"},children:e.jsx("div",{className:"absolute bottom-0 left-1/2 w-3 h-3 bg-white rounded-full -translate-x-1/2"})})]})]}),e.jsx("div",{className:"w-full max-w-md space-y-4",children:d.map((s,m)=>e.jsx(C,{icon:s.icon,label:s.label,isActive:c===m,isComplete:c>m,gradient:i.gradient},m))}),e.jsxs("div",{className:"w-full max-w-md mt-8",children:[e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full bg-gradient-to-r ${i.gradient} transition-all duration-500 ease-out`,style:{width:`${c/d.length*100}%`}})}),e.jsxs("p",{className:"text-center text-sm text-gray-500 mt-2",children:[Math.round(c/d.length*100),"% completado"]})]})]}),f&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-8 bg-white/95",children:e.jsx("div",{className:"max-w-md",children:e.jsxs("div",{className:"bg-red-50 border-2 border-red-200 rounded-2xl p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-3xl",children:"‚ö†Ô∏è"})}),e.jsx("h3",{className:"text-lg text-red-900 mb-2",children:"Error en el an√°lisis"}),e.jsx("p",{className:"text-sm text-red-700 mb-4",children:f}),e.jsx("button",{onClick:t,className:"px-6 py-2 bg-red-500 text-white rounded-xl hover:bg-red-600 transition-colors",children:"Volver e intentar de nuevo"})]})})})]})}export{O as DiagnosisAnalysis};
